---
title: "Fastify"
description: "Set up your Fastify application with Apitally to monitor API traffic, errors, performance and uptime."
---

import SetupGuideStartSnippet from '/snippets/setup-guide-start.mdx';
import CreateAppSnippet1 from '/snippets/create-app-1.mdx';
import CreateAppSnippet2 from '/snippets/create-app-2.mdx';

This page guides you through the steps of configuring your [Fastify](https://fastify.dev) application to work with Apitally. If you don't have an account yet, now would be a good time to [sign up](https://app.apitally.io/?signup).

<SetupGuideStartSnippet framework="Fastify" />

## Create app

<CreateAppSnippet1 framework="Fastify" />

![Create app](https://assets.apitally.io/docs/create-app-fastify.png)

<CreateAppSnippet2 />

## Add plugin

Next, install the [Apitally client library](https://www.npmjs.com/package/apitally) and the [fastify-plugin](https://www.npmjs.com/package/fastify-plugin) package in your Fastify project.

<CodeGroup>
```shell npm
npm install apitally fastify-plugin
```

```shell yarn
yarn add apitally fastify-plugin
```
</CodeGroup>

Register the Apitally plugin with your Fastify application and provide the `clientId` for your app.
You'll find the `clientId` on the _Setup instructions_ page for your app in the Apitally dashboard, which is displayed immediately after creating the app.

<CodeGroup>
```javascript ESM
import Fastify from "fastify";
import { apitallyPlugin } from "apitally/fastify";

const fastify = Fastify({ logger: true });

await fastify.register(apitallyPlugin, {
  clientId: "your-client-id",
  env: "dev", // or "prod" etc.
});
```

```javascript CommonJS
const fastify = require("fastify")({ logger: true });
const { apitallyPlugin } = require("apitally/fastify");

fastify.register(apitallyPlugin, {
  clientId: "your-client-id",
  env: "dev", // or "prod" etc.
});

// Wrap your routes in a plugin, so Apitally can detect them
fastify.register((instance, opts, done) => {
  instance.get("/", (request, reply) => {
    reply.send("hello");
  });
  done();
});
```
</CodeGroup>

<div className="mt-4">
  <Snippet file="add-middleware-check.mdx" />
</div>

## Identify consumers

<Snippet file="identify-consumers.mdx" />

To associate requests with consumers, set the `consumerIdentifier` property on the [`Request`](https://fastify.dev/docs/latest/Reference/Request/) object, for example in your authentication function.

```javascript
fastify.addHook("onRequest", async (request, reply) => {
  try {
    await request.jwtVerify(); // Assuming @fastify/jwt is used for authentication
    request.consumerIdentifier = request.user.name;
  } catch (err) {
    reply.send(err);
  }
});
```

<Snippet file="consumer-identifier.mdx" />

<Snippet file="identify-consumers-check.mdx" />
