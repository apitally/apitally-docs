---
title: "FastAPI"
description: "High performance, easy to learn, fast to code, ready for production."
---

## Basic setup

To get started, create a new app in Apitally and select FastAPI as your framework.

Install the [Apitally Python client](https://pypi.org/project/apitally/) in your FastAPI project (e.g. using `pip` or `poetry`) with the `fastapi` extra.

<CodeGroup>
```shell pip
pip install apitally[fastapi]
```

```toml poetry (pyproject.toml)
[tool.poetry.dependencies]
apitally = { version = "*", extras = ["fastapi"] }
```

</CodeGroup>

Add the Apitally middleware to your FastAPI application and provide the `client_id` for your app.
The `client_id` is displayed in Apitally immediately after creating the app or on the _Setup instructions_ page for your app.

<CodeGroup>

```python Default env
from fastapi import FastAPI
from apitally.fastapi import ApitallyMiddleware

app = FastAPI()
app.add_middleware(ApitallyMiddleware, client_id="your-client-id")
```

```python Custom env
from fastapi import FastAPI
from apitally.fastapi import ApitallyMiddleware

app = FastAPI()
app.add_middleware(
    ApitallyMiddleware,
    client_id="your-client-id",
    env="your-env-name",
)
```

</CodeGroup>

<div className="mt-5">
  <Note>
    If you're also using other middlewares, put the `ApitallyMiddleware` first,
    so that it wraps the existing stack of middlewares.
  </Note>
</div>

If you have multiple environments for your application, provide the name of the current environment using the `env` argument (use alphanumeric characters and hyphens only).

New environments will be visible in Apitally as soon as data is received from them. You can mark environments as production or non-production on the _Manage environments_ screen.

## Using API key authentication

Enable the synchronization of API key hashes from Apitally to your application by setting the `enable_keys` argument to `True` when adding the middleware.

```python
app.add_middleware(
    ApitallyMiddleware,
    client_id="your-client-id",
    env="your-env-name",
    enable_keys=True,  # <--
)
```

<div className="-mt-4">
  <Info>
    The synchronization happens once at application startup and then every 60
    seconds.
  </Info>
</div>

In FastAPI you can secure individual endpoints, routers or the whole application with API key authentication.

Use the `Security` dependency and pass the `api_key_auth` function from the Apitally client library as the first argument, as shown in the examples below.
You can optionally specify a list of `scopes` that the API key must have as well.

If you want to access information about the API key in your endpoint function, add the dependency as an argument to the function instead.

<CodeGroup>

```python Endpoint dependency
from fastapi import FastAPI, Security
from apitally.fastapi import ApitallyMiddleware, api_key_auth

app = FastAPI()
app.add_middleware(ApitallyMiddleware, client_id="your-client-id", enable_keys=True)

@app.get("/items", dependencies=[Security(api_key_auth, scopes=["read:items"]))
def list_items():
    return ["item1"]
```

```python Endpoint function argument
from fastapi import FastAPI, Security
from apitally.fastapi import ApitallyMiddleware, KeyInfo, api_key_auth

app = FastAPI()
app.add_middleware(ApitallyMiddleware, client_id="your-client-id", enable_keys=True)

@app.get("/items")
def list_items(key: KeyInfo = Security(api_key_auth, scopes=["read:items"])):
    return ["item1"]
```

```python Router dependency
from fastapi import FastAPI, Router, Security
from apitally.fastapi import ApitallyMiddleware, api_key_auth

app = FastAPI()
app.add_middleware(ApitallyMiddleware, client_id="your-client-id", enable_keys=True)

router = Router(dependencies=[Security(api_key_auth)])
app.include_router(router, prefix="/secure")

@router.get("/items")
def list_items():
    return ["item1"]
```

```python App dependency
from fastapi import FastAPI, Security
from apitally.fastapi import ApitallyMiddleware, api_key_auth

app = FastAPI(dependencies=[Security(api_key_auth)]
app.add_middleware(ApitallyMiddleware, client_id="your-client-id", enable_keys=True)

@app.get("/items")
def list_items():
    return ["item1"]
```

</CodeGroup>
