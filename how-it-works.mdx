---
title: "How it works"
description: "A good look under the hood."
---

## Client libraries

Apitally integrates directly with your application through one of our open-source client libraries, which is a small dependency to add to your project.

<CardGroup cols={2}>
  <Card
    title="Client library for Python"
    icon="python"
    href="https://github.com/apitally/python-client"
    target="_blank"
  >
    GitHub repository
  </Card>
  <Card
    title="Client library for Node.js"
    icon="js"
    href="https://github.com/apitally/nodejs-client"
    target="_blank"
  >
    GitHub repository
  </Card>
</CardGroup>

The diagram below illustrates how the client libraries works.

<img
  className="block dark:hidden rounded-xl"
  style={{ border: "solid 1px #22222222" }}
  src="https://assets.apitally.io/docs/how-it-works-light.png"
  alt="Diagram showing how the Apitally client library works"
/>
<img
  className="hidden dark:block rounded-xl"
  style={{ border: "solid 1px #dddddd22" }}
  src="https://assets.apitally.io/docs/how-it-works-dark.png"
  alt="Diagram showing how the Apitally client library works"
/>

The client libraries include the following features:

- Introspection of your application to capture metadata about endpoints.
- Lightweight middleware for each supported framework, which captures request and response metadata.
- A non-blocking client that handles communication with the Apitally Hub.
- Functions that allow you to easily secure endpoints with API key authentication and permission checks.

<Note>
  The client libraries are designed to be resilient to temporary network failures
  when communicating with the Apitally Hub and will retry sending data for up to
  1 hour.
</Note>

### On startup

When your application starts running and the Apitally middleware is initialized, it introspects your application to capture metadata about all available endpoints.
This metadata is then sent to the Apitally Hub in a once-off request.

If you have enabled the synchronization of API keys, the client will also retrieve API key hashes and metadata from the Apitally Hub.
This is so that your application can validate API keys locally without having to make a network request.

### During runtime

When your application receives a request, the middleware times the invokation of the request handler and captures metadata about the request and response, such as the HTTP method, path and the HTTP status code.
If the response is a validation error (status 400 or 422), the middleware inspects the response body for further details about the error.

The captured metadata is then passed to the client which immediately aggregates it with previously received data.
The client synchronizes the aggregated data with the Apitally Hub in one minute intervals.

If you have enabled the synchronization of API keys, the client will also fetch updated API key hashes and metadata from the Apitally Hub in the same interval.

<Note>
  The communication with the Apitally Hub happens either asynchronously or in a
  separate thread, depending on your framework, which means that it doesn't
  interfere with your applications' handling of requests.
</Note>

## Server side

When the Apitally Hub receives data from your application, it puts it in a queue for asynchronous processing. The data should be processed and visible on the dashboard within a few seconds.

Data is retained for up to 12 months and deleted after that.
